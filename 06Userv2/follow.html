<!DOCTYPE html>

<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <script type="text/javascript" src="../jquery.min.js"></script>
    <script type="text/javascript" src="../settings.js"></script>
    <script type="text/javascript" src="../osql.js"></script>

    <script>
        var x;
        $().ready(function() {
            setFromid();
            showAllUsers();
            showFollowing();
        });

        function button1Pressed() {
            doInsert();
        }

        function setFromid() {
            var userid = osql.getParam("userid");
            document.getElementById("tf1").value = userid;
        }

        async function doInsert() {
            var fromid = document.getElementById("tf1").value;
            var toid = document.getElementById("tf2").value;

            var sql = "insert into Follows values('" + fromid + "', '" + toid + "');";
            var objects = await osql.connect(sql);
            console.log(objects);

            document.getElementById("follow-result").innerHTML = "フォローしました";
            document.getElementById("tf2").value = "";
            showFollowing();
        }

        async function showAllUsers() {
            var sql = "select * from Users;";
            var objects = await osql.connect(sql);
            console.log(objects);
            var html = "";
            html += "<table border=1>";
            html += "<tr><th>id</th><th>name</th>";
            for (var i = 0; i < objects.length; i++) {
                var object = objects[i];
                html += "<tr>";
                html += "<td>" + object.id + "</td>";
                html += "<td>" + object.name + "</td>";
                html += "</tr>";
            }
            html += "</table>";
            document.getElementById("users-table").innerHTML = html;
        }

        async function showFollowing() {
            var fromid = document.getElementById("tf1").value;
            var sql = "select toid, name from Users inner join Follows on Users.id = Follows.toid where fromid = '" + fromid + "';";
            var objects = await osql.connect(sql);
            console.log(objects);
            var html = "";
            html += "<table border=1>";
            html += "<tr><th>toid</th><th>name</th></tr>";
            for (var i = 0; i < objects.length; i++) {
                var object = objects[i];
                html += "<tr>";
                html += "<td>" + object.toid + "</td>";
                html += "<td>" + object.name + "</td>";
                html += "</tr>";
            }
            html += "</table>";
            document.getElementById("follows-table").innerHTML = html;
        }
    </script>

</head>

<body>
    <h1>Tweets</h1>
    <h2>フォロー</h2>
    フォロー元のユーザID:
    <input id="tf1" type="text" disabled>
    <br> フォロー先のユーザID:
    <input id="tf2" type="text">
    <button onclick="button1Pressed()">フォロー</button>
    <p id="follow-result"><br></p>
    <hr>
    <p id="users-table" style="float: left;"></p>
    <p id="follows-table" style="float: left; margin-left: 20px;"></p>
</body>

</html>